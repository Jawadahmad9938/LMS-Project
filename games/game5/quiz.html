<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flip Cards</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #d0e2f1;
        }

        #startBtn {
            padding: 12px 28px;
            font-size: 22px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            background: #1e90ff;
            color: #fff;
            transition: background 0.3s;
        }

        #startBtn:hover {
            background: #1c7ad9;
        }

        .board {
            display: none;
            grid-template-columns: repeat(5, 100px);
            gap: 40px;
            perspective: 900px;
            margin-top: 24px;
        }

        .card {
            width: 120px;
            height: 150px;
            cursor: pointer;
        }

        .inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.45s;
        }

        .card.is-flipped .inner {
            transform: rotateY(180deg);
        }

        .side {
            position: absolute;
            inset: 0;
            border: 2px solid #444;
            backface-visibility: hidden;
        }

        .front img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .back {
            background: #444;
            color: #fff;
            font-size: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .front {
            transform: rotateY(180deg);
        }
    </style>
</head>

<body>
    <button id="startBtn">Start Flipping</button>
    <div class="board" id="board"></div>

    <script src="input.js"></script>

    <script>
        let quizStartTime = Date.now();
        let totalCorrect = 0;
        let totalQuestions = 0;

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}m ${secs}s`;
        }

        function LMSFinishResponse() {
            const timeSpent = Math.floor((Date.now() - quizStartTime) / 1000);
            const score = totalQuestions > 0 ? (totalCorrezct / totalQuestions) * 100 : 0;
            const status = timeSpent <= 60 ? "passed" : "failed";
            console.log(
                `LMS finish: Quiz completed - Status=${status}, Score=${score.toFixed(2)}%, Time=${formatTime(timeSpent)}`
            );

            // Optional alert
            // alert(`Quiz Completed!\nStatus: ${status}\nScore: ${score.toFixed(2)}%\nTime: ${formatTime(timeSpent)}`);
        }


        document.addEventListener("DOMContentLoaded", () => {
            const startBtn = document.getElementById("startBtn");
            const board = document.getElementById("board");
            const gameData = window.inputData;

            if (!gameData || !gameData.cards) {
                alert("Game data not found or invalid format in input.js");
                return;
            }

            const beep = new Audio(gameData.beep || "audio/beep.mp3");

            startBtn.addEventListener("click", startGame);

            function startGame() {
                startBtn.style.display = "none";
                board.style.display = "grid";

                if (gameData.qaudio) {
                    const qAudio = new Audio(gameData.qaudio);
                    qAudio.play().catch(() => { });
                }

                const imgPaths = gameData.cards.map(c => c.img);
                const cardsData = [...imgPaths, ...imgPaths];
                for (let i = cardsData.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [cardsData[i], cardsData[j]] = [cardsData[j], cardsData[i]];
                }

                board.innerHTML = "";
                cardsData.forEach(src => {
                    const card = document.createElement("div");
                    card.className = "card";
                    card.dataset.src = src;
                    card.innerHTML = `
            <div class="inner">
              <div class="side front"><img src="${src}" alt=""></div>
              <div class="side back"></div>
            </div>`;
                    board.appendChild(card);
                });

                let first = null;
                let lock = true;
                let matchedPairs = 0;
                const totalPairs = imgPaths.length;
                totalCorrect = 0;
                totalQuestions = 0;
                quizStartTime = Date.now();

                const allCards = document.querySelectorAll(".card");
                allCards.forEach(c => c.classList.add("is-flipped"));
                setTimeout(() => {
                    allCards.forEach(c => c.classList.remove("is-flipped"));
                    lock = false;
                }, 3000);

                board.addEventListener("click", onCardClick);

                function onCardClick(e) {
                    const card = e.target.closest(".card");
                    if (!card || card.classList.contains("is-flipped") || lock) return;

                    try {
                        beep.currentTime = 0;
                        beep.play();
                    } catch { }

                    card.classList.add("is-flipped");

                    if (!first) {
                        first = card;
                        return;
                    }

                    lock = true;
                    const second = card;
                    const match = first.dataset.src === second.dataset.src;

                    if (match) {
                        [first, second].forEach(c => (c.style.cursor = "default"));
                        totalCorrect++;
                        totalQuestions++;
                        matchedPairs++;

                        if (matchedPairs === totalPairs) {
                            LMSFinishResponse();
                        }

                        reset();
                    } else {
                        totalQuestions++;
                        setTimeout(() => {
                            first.classList.remove("is-flipped");
                            second.classList.remove("is-flipped");
                            reset();
                        }, 850);
                    }
                }

                function reset() {
                    first = null;
                    lock = false;
                }
            }
        });
    </script>
</body>

</html>